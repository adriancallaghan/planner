
<div class="div-table container-fluid well well-small">
    <div class="row-fluid">

        Balance on date
        
    </div>
</div>

<div class="div-table container-fluid well well-small">

    <!-- header -->
    <div class="div-table-header row-fluid">
        <div class="span2">Date</div>
        <div class="span2">Balance</div>
        <div class="span8">Transactions<a class="btn btn-warning btn-mini pull-right" href="#myModal" role="button" data-toggle="modal">+</a></div> 
    </div>

    <?php foreach($this->dates AS $dateKey=>$dateVal) : ?>
    
        <!-- content -->
        <div class="div-table-row row-fluid date <?php if ($this->todayKey==$dateKey) echo 'current'; ?>">

 
            <!-- Date -->
            <div class='date-title span2'>
                <?php echo date('jS M Y',$dateVal->unix); ?>
            </div>

            
            <!-- Balance -->
            <div class="date-balance span2 <?php echo $dateVal->balance==0 ? 'neutral' : $dateVal->balance>0 ? 'positive' : 'negative'; ?>">
                &pound; <?php echo $dateVal->balance; ?>
            </div>


            <!-- Transactions -->   
            <div class="date-transactions span8">

                <ul id="<?php echo $dateKey; ?>" class="unstyled">

                    
                    <?php foreach ($dateVal->transactions AS $transKey=>$transVal) : ?>
                    
                        <li id="<?php echo $transKey; ?>" class="clearfix span4 btn-group date-transaction">

                            <?php                             
                            $classes = $transVal->amount>0 ? 'btn btn-small btn-success' : 'btn btn-small btn-danger';
                            $account = isset($this->accounts[$transVal->account]) ? $this->accounts[$transVal->account] : 'unknown'; 
                            $details = '&pound;'.str_replace('-', '', $transVal->amount).' '.($transVal->amount>0 ? 'from' : 'to'). ' '.$account;
                            
                            $tags = '';
                            foreach($transVal->tags AS $tag) {                                    
                                if (isset($this->transactionTags[$tag])){
                                    $tags.= $this->transactionTags[$tag];
                                }
                            }
                            
                            $popup = $details.' '.$this->transactionTypes[$transVal->type].' '.$tags.' '.$transVal->note;
                            
                            ?>

                                
                            <a title="" 
                               data-content="<?php echo $popup; ?>" 
                               data-placement="left" 
                               data-toggle="popover" 
                               class="span10 <?php echo $classes; ?> transaction-details" 
                               href="#" 
                               data-original-title="<?php echo $account; ?>">
                                <span class="visible-desktop"><?php echo $details; ?></span>                                    
                                <span class="hidden-desktop"><?php echo '&pound;'.str_replace('-', '', $transVal->amount); ?></span> 
                            </a>

                            
                            <button class="transaction-options dropdown-toggle <?php echo $classes; ?> span2" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>

                            <ul class="dropdown-menu">
                                <li><a href="#myModal" role="button" data-toggle="modal"><i class="icon-pencil"></i> Edit</a></li>
                                <li><a href="#myModal" role="button" data-toggle="modal"><i class="icon-remove"></i> Disable</a></li>
                                <li><a href="#myModal" role="button" data-toggle="modal"><i class="icon-repeat"></i> Reoccuring</a></li>
                            </ul>
                            
                        </li>
                    <?php endforeach; ?>
                </ul> 
            </div>
        </div>
    <?php endforeach; ?>
</div>

     
<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">Add transaction</h3>
    </div>
    <div class="modal-body">
        <p>Select details here</p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button class="btn btn-primary">Save changes</button>
    </div>
</div>


<script type='text/javascript'>
$(function() {
    
    $('.transaction-details').popover({
        trigger: 'hover',
        delay: { show: 500, hide: 0 }
      } 
    );
    
    $(".date-transactions ul").sortable({
        connectWith: ".date-transactions ul",
        opacity: 0.6, 
        cursor: 'move',
        update : function(e, ui) {
                var id = ui.item.attr('id');
                var to = $(this).attr('id');
                console.log('id: ' + id + ' to: ' + to);
                console.log('order: ')
                console.log($(this).children());
            }
                    
    });
    
 
    
});
</script>

